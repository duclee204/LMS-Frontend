<div class="layout-row">
  <app-sidebar></app-sidebar>
  <div class="main-content">
    <h1>Courses</h1>
    <div class="search-create-row">
      <input class="search-input" placeholder="Search" type="search" [(ngModel)]="searchTerm"/>
      <button (click)="isCreating = !isCreating"
              class="create-btn-green ml-auto">
        {{ isCreating ? 'Close' : 'Create' }}
      </button>
    </div>
    <div class="courses-container">
      <div class="create-btn-wrapper">
        <div class="bg-[#cce6ff] rounded-md p-4 space-y-4">
          <!-- Form t·∫°o kh√≥a h·ªçc -->
          <div *ngIf="isCreating">
            <div class="form-overlay" (click)="cancelCreating()"></div>
            <div class="form-popup-container1">
              <div class="form-popup">
                <input [(ngModel)]="courseForm.title" type="text" placeholder="Course Title" />
                <textarea [(ngModel)]="courseForm.description" placeholder="Description"></textarea>
                <select [(ngModel)]="courseForm.categoryId">
                  <option value="" disabled>Select Category</option>
                  <option *ngFor="let category of categories" [value]="category.categoryId">
                    {{ category.name }}
                  </option>
                </select>
                <select [(ngModel)]="courseForm.instructorId">
                  <option value="" disabled>Select Instructor</option>
                  <option *ngFor="let instructor of instructors" [value]="instructor.userId">
                    {{ instructor.fullName }}
                  </option>
                </select>
                <select [(ngModel)]="courseForm.status">
                  <option value="" disabled>Select Status</option>
                  <option value="draft">Draft</option>
                  <option value="published">Published</option>
                  <option value="archived">Archived</option>
                </select>
                <input [(ngModel)]="courseForm.price" type="number" placeholder="Price" step="0.01" />
                <input type="file" (change)="onFileSelected($event)" accept="image/*" />
                <div *ngIf="imagePreviewUrl" class="image-preview">
                  <img [src]="imagePreviewUrl" alt="Preview" />
                </div>
                <div class="form-buttons">
                  <button (click)="cancelCreating()" class="cancel-btn">Cancel</button>
                  <button (click)="submitCourse()" class="submit-btn">Submit</button>
                </div>
              </div>
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 course-grid">
            <div *ngFor="let course of getPagedCourses()" class="bg-white rounded-lg shadow-md overflow-hidden course-card">
              <img *ngIf="course.thumbnailUrl"
                   [src]="'http://localhost:8080/images/' + course.thumbnailUrl"
                   alt="Thumbnail" />
              <div class="p-3">
                <p class="text-xs text-[#2a3a5b] font-semibold mb-2 select-none">{{ course.title }}</p>
                <div class="flex items-center gap-2">
                  <img [src]="course.instructorImage" alt="Instructor"
                       class="w-6 h-6 rounded-full instructor-img" />
                </div>
                <button (click)="viewCourse(course)"
                        class="mt-3 w-full bg-[#2a52e2] text-white text-xs font-semibold rounded px-2 py-1">
                  Xem chi ti·∫øt
                </button>
              </div>
            </div>
          </div>
          <!-- Pagination controls -->
          <div *ngIf="getTotalPages() > 1" class="pagination">
            <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
              &lt;
            </button>
            <ng-container *ngFor="let page of [].constructor(getTotalPages()); let i = index">
              <button (click)="goToPage(i + 1)"
                      [class.active]="currentPage === (i + 1)"
                      [disabled]="currentPage === (i + 1)">
                {{ i + 1 }}
              </button>
            </ng-container>
            <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === getTotalPages()">
              &gt;
            </button>
          </div>
        </div>
      </div>
      <!-- K·∫øt th√∫c courses-container -->
    </div>
    <!-- Popup chi ti·∫øt -->
    <div *ngIf="isViewing && selectedCourse">
      <div class="form-overlay" (click)="cancelEditing()"></div>
      <div class="form-popup-container2">
        <div class="form-popup">
          <input [(ngModel)]="selectedCourse.title" type="text" placeholder="Course Title" />
          <textarea [(ngModel)]="selectedCourse.description" placeholder="Description"></textarea>
          <select [(ngModel)]="selectedCourse.categoryId">
            <option *ngFor="let category of categories" [value]="category.categoryId">
              {{ category.name }}
            </option>
          </select>
          <select [(ngModel)]="selectedCourse.instructorId">
            <option *ngFor="let instructor of instructors" [value]="instructor.userId">
              {{ instructor.fullName }}
            </option>
          </select>
          <select [(ngModel)]="selectedCourse.status">
            <option value="draft">Draft</option>
            <option value="published">Published</option>
            <option value="archived">Archived</option>
          </select>
          <input [(ngModel)]="selectedCourse.price" type="number" placeholder="Price" step="0.01" />
          <input type="file" (change)="onFileSelected($event)" accept="image/*" />
          <div *ngIf="imagePreviewUrl" class="image-preview">
            <img [src]="imagePreviewUrl" alt="Preview" />
          </div>
          <div class="form-buttons">
            <button (click)="cancelEditing()" class="cancel-btn">Cancel</button>
            <button type="button"
                    (click)="updateCourse()"
                    class="bg-yellow-500 text-white text-xs font-semibold px-4 py-1 rounded">
              Update
            </button>
            <button (click)="deleteSelectedCourse()">üóë Xo√° kho√° h·ªçc n√†y</button>
          </div>
        </div>
      </div>
    </div>
    <div class="user-profile">
      <img alt="Female user profile portrait with brown hair and glasses" height="32" src="https://storage.googleapis.com/a1aa/image/eb79ed3b-5aef-44ac-ad12-9ff392170d3d.jpg" width="32"/>
      <div class="user-text">
        <p class="user-name">Emila Harry</p>
        <p class="user-role">Instructor</p>
      </div>
      <i class="fas fa-chevron-down user-chevron"></i>
    </div>
  </div>
</div>

